/*
 *  Name 	: Jquery Column Master
 *  Version : 0.1
 *  Author	: kohei kinoshita
 */
(function(e){e.fn.columnMaster=function(t){var n=new Object;n.target=e(this);n.selector=e(this).selector;n.options=e.extend({btnCol:1,RowSelector:"tbody > tr",dataName:"data",fadeInterval:800,button:{add:'<button type="button" class="btn btn-primary btn-sm"><span class="glyphicon glyphicon-plus"></span></button>',del:'<button type="button" class="btn btn-danger btn-sm"><span class="glyphicon glyphicon-minus"></span></button>'},RowLimit:false,LimitAlert:"Limit %d Rows!!!"},t);n.rowGetAction=function(){n.row=n.target.find(t.RowSelector)};n.Initialize=function(){n.rowGetAction();n.pureRow=n.row.eq(0).clone(true);n.pureRow.find("input,textarea").each(function(){if(e(this).attr("type")!=="checkbox"){e(this).val("")}else{e(this).prop("checked",false)}});e(n.row).each(function(t){e(this).find("input,select,textarea").each(function(){e(this).attr("name",n.options.dataName+"["+t+"]["+e(this).attr("data-name")+"]")})})};n.delAction=function(){e(document).on("click","[data-role=delete]",function(){var n=e(this).parents()[1];e(n).animate({opacity:0},t.fadeInterval,function(){e(this).remove()})})};n.AddAction=function(){e(document).on("click","[data-role=add]",function(){if(!n.isLimit()){return false}var r=e(this).parents()[1];var i=e(this).parent().clone();e(this).parent().animate({opacity:0},t.fadeInterval,function(){e(this).remove();e(r).append(e(n.pureRow).css("opacity",0).animate({opacity:1},t.fadeInterval,function(){e(r).append(e(i).css("opacity",0).animate({opacity:1},t.fadeInterval))}));n.Initialize();n.setDeleteButton()})})};n.setDeleteButton=function(){n.row.each(function(t){e(this).find("td").eq(n.options.btnCol-1).empty().css("text-align","center").append(e(n.options.button.del).attr("data-role","delete"))})};n.setAddButton=function(){e(n.row).parent().append(e("<td></td>").css("text-align","center").append(e(n.options.button.add).attr("data-role","add")))};n.alert=function(){var e=n.options.LimitAlert.replace("%d",n.options.RowLimit);alert(e)};n.countRow=function(){var t=e(n.selector).find("tr");return t.length};n.isLimit=function(){if(n.options.RowLimit!==false&&n.countRow()>n.options.RowLimit){n.alert();return false}else{return true}};n.Initialize();n.setDeleteButton();n.setAddButton();n.delAction();n.AddAction()}})(jQuery)